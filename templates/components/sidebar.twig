{# Sidebar Component - Desktop and Mobile #}
<div class="flex h-screen bg-gray-50">
  {# Desktop Sidebar #}
  <div class="hidden lg:flex lg:shrink-0">
    <div class="w-64 bg-white border-r">
      <div class="flex flex-col h-full">
        {# Header #}
        <div class="p-6 border-b">
          <h2 class="text-2xl font-bold text-blue-600">Ticketly</h2>
          <p class="text-sm text-gray-600 mt-1" id="sidebar-user-name">Welcome</p>
        </div>

        {# Navigation #}
        <nav class="flex-1 p-4 space-y-2">
          <a
            href="?page=dashboard"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors {% if current_page == 'dashboard' %}bg-blue-100 text-blue-700 font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %}"
          >
            <span>Dashboard</span>
          </a>

          <a
            href="?page=tickets"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors {% if current_page == 'tickets' %}bg-blue-100 text-blue-700 font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %}"
          >
            <span>Tickets</span>
          </a>
        </nav>

        {# Stats Section #}
        <div class="p-4 border-t bg-gray-50">
          <h3 class="text-sm font-medium text-gray-900 mb-3">Quick Stats</h3>
          <div class="space-y-2" id="sidebar-stats">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Total</span>
              <span class="text-sm font-medium text-blue-600" id="stat-total">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Open</span>
              <span class="text-sm font-medium text-green-600" id="stat-open">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">In Progress</span>
              <span class="text-sm font-medium text-amber-600" id="stat-in-progress">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Closed</span>
              <span class="text-sm font-medium text-gray-600" id="stat-closed">0</span>
            </div>
          </div>
        </div>

        {# User Actions #}
        <div class="p-4 border-t">
          <button
            onclick="handleLogout()"
            class="w-full px-4 py-2 text-sm font-medium rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors"
          >
            <span class="mr-2">ðŸ‘‹</span>
            Logout
          </button>
        </div>
      </div>
    </div>
  </div>

  {# Mobile Menu Overlay #}
  <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>

  {# Mobile Sidebar #}
  <div id="mobile-sidebar" class="fixed inset-y-0 left-0 w-80 bg-white transform -translate-x-full transition-transform duration-300 ease-in-out z-50 lg:hidden">
    <div class="flex flex-col h-full">
      {# Header #}
      <div class="p-6 border-b">
        <h2 class="text-2xl font-bold text-blue-600">Ticketly</h2>
        <p class="text-sm text-gray-600 mt-1" id="mobile-sidebar-user-name">Welcome</p>
      </div>

      {# Navigation #}
      <nav class="flex-1 p-4 space-y-2">
        <a
          href="?page=dashboard"
          class="flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors {% if current_page == 'dashboard' %}bg-blue-100 text-blue-700 font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %}"
          onclick="toggleMobileMenu()"
        >
          <span>Dashboard</span>
        </a>

        <a
          href="?page=tickets"
          class="flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors {% if current_page == 'tickets' %}bg-blue-100 text-blue-700 font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %}"
          onclick="toggleMobileMenu()"
        >
          <span>Tickets</span>
        </a>
      </nav>

      {# Stats Section #}
      <div class="p-4 border-t bg-gray-50">
        <h3 class="text-sm font-medium text-gray-900 mb-3">Quick Stats</h3>
        <div class="space-y-2" id="mobile-sidebar-stats">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Total</span>
            <span class="text-sm font-medium text-blue-600" id="mobile-stat-total">0</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Open</span>
            <span class="text-sm font-medium text-green-600" id="mobile-stat-open">0</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">In Progress</span>
            <span class="text-sm font-medium text-amber-600" id="mobile-stat-in-progress">0</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Closed</span>
            <span class="text-sm font-medium text-gray-600" id="mobile-stat-closed">0</span>
          </div>
        </div>
      </div>

      {# User Actions #}
      <div class="p-4 border-t">
        <button
          onclick="handleLogout()"
          class="w-full px-4 py-2 text-sm font-medium rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors"
        >
          <span class="mr-2">ðŸ‘‹</span>
          Logout
        </button>
      </div>
    </div>
  </div>

  {# Main Content Area #}
  <div class="flex-1 flex flex-col overflow-hidden">
    {# Mobile Header #}
    <div class="lg:hidden bg-white border-b px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl font-bold text-blue-600">Ticketly</h1>
      <button
        id="mobile-menu-button"
        class="p-2 rounded-md hover:bg-gray-100 transition-colors"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    {# Main Content #}
    <div class="flex-1 overflow-auto">
      <div class="max-w-[1440px] mx-auto">
        {% block app_content %}{% endblock %}
      </div>
    </div>
  </div>
</div>

<script>
// Update sidebar with user info and stats
function updateSidebar() {
  const user = getCurrentUser();
  const stats = getTicketStats();
  
  // Update user name
  if (user) {
    const userName = `Welcome, ${user.name}`;
    const desktopName = document.getElementById('sidebar-user-name');
    const mobileName = document.getElementById('mobile-sidebar-user-name');
    if (desktopName) desktopName.textContent = userName;
    if (mobileName) mobileName.textContent = userName;
  }
  
  // Update stats - Desktop
  document.getElementById('stat-total').textContent = stats.total;
  document.getElementById('stat-open').textContent = stats.open;
  document.getElementById('stat-in-progress').textContent = stats.inProgress;
  document.getElementById('stat-closed').textContent = stats.closed;
  
  // Update stats - Mobile
  document.getElementById('mobile-stat-total').textContent = stats.total;
  document.getElementById('mobile-stat-open').textContent = stats.open;
  document.getElementById('mobile-stat-in-progress').textContent = stats.inProgress;
  document.getElementById('mobile-stat-closed').textContent = stats.closed;
}

// Handle logout
function handleLogout() {
  localStorage.removeItem('ticketapp_session');
  localStorage.removeItem('ticketapp_user');
  showToast('Logged out successfully', 'success');
  setTimeout(() => {
    window.location.href = '?page=landing';
  }, 500);
}

// Initialize sidebar on page load
document.addEventListener('DOMContentLoaded', function() {
  // Check authentication for protected pages
  const currentPage = new URLSearchParams(window.location.search).get('page');
  if (['dashboard', 'tickets'].includes(currentPage)) {
    if (!isAuthenticated()) {
      window.location.href = '?page=login';
      return;
    }
    updateSidebar();
  }
});
</script>
